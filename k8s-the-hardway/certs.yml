- hosts: localhost
  become: True
  gather_facts: True
  vars_files:
    - vars.yml
  tasks:
    ## Provision a CA
    - name: Configure the private CA key
      openssl_privatekey:
        path: /etc/ssl/private/k8s_ca.pem
        size: 4096
        type: RSA

    - name: Configure the private CA CSR
      openssl_csr:
        common_name: kubernetes         #CN
        country_name: US                #C
        locality_name: "Salt Lake City" #L
        organization_name: kubernetes   #O
        organizational_unit_name: CA    #OU
        path: /etc/ssl/certs/k8s_ca.csr
        privatekey_path: /etc/ssl/private/k8s_ca.pem
        state_or_province_name: UT      #ST
 
    - name: Configure the private CA Cert
      openssl_certificate:
        csr_path: /etc/ssl/certs/k8s_ca.csr
        path: /etc/ssl/certs/k8s_ca.crt
        privatekey_path: /etc/ssl/private/k8s_ca.pe
        provider: ownca